<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM Application</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { padding: 20px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h2>CRM Login</h2>
    <div id="login-section">
        <input type="email" id="email" class="form-control" placeholder="Email">
        <input type="password" id="password" class="form-control mt-2" placeholder="Password">
        <button class="btn btn-primary mt-2" onclick="login()">Login</button>
    </div>

    <div id="dashboard-section" class="hidden">
        <h2>Admin Dashboard</h2>
        <p id="dashboard-metrics"></p>
        <button class="btn btn-danger" onclick="logout()">Logout</button>
    </div>

    <div id="telecaller-section" class="hidden">
        <h2>Telecaller Page</h2>
        <ul id="leads-list"></ul>
    </div>

    <script>
        let userRole = null;

        function login() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            fetch("http://localhost:8080/api/auth/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password })
            })
            .then(response => response.json())
            .then(data => {
                userRole = data.role;
                document.getElementById("login-section").classList.add("hidden");

                if (userRole === "admin") {
                    document.getElementById("dashboard-section").classList.remove("hidden");
                    loadDashboard();
                } else if (userRole === "telecaller") {
                    document.getElementById("telecaller-section").classList.remove("hidden");
                    loadLeads();
                }
            })
            .catch(error => alert("Login Failed"));
        }

        function logout() {
            userRole = null;
            document.getElementById("login-section").classList.remove("hidden");
            document.getElementById("dashboard-section").classList.add("hidden");
            document.getElementById("telecaller-section").classList.add("hidden");
        }

        function loadDashboard() {
            fetch("http://localhost:3000/api/dashboard")
            .then(response => response.json())
            .then(data => {
                document.getElementById("dashboard-metrics").innerHTML =
                    `Total Calls: ${data.totalCalls}, Total Telecallers: ${data.totalTelecallers}, Total Customers: ${data.totalCustomers}`;
            });
        }

        function loadLeads() {
            fetch("http://localhost:8080/api/leads")
            .then(response => response.json())
            .then(data => {
                let list = document.getElementById("leads-list");
                list.innerHTML = "";
                data.forEach(lead => {
                    list.innerHTML += `<li>${lead.name} - ${lead.email}</li>`;
                });
            });
        }
    </script>
</body>
</html>
